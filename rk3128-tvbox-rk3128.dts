/dts-v1/;
#include "rk3128.dtsi"

/ {
	model = "Generic RK3128 TV Box (HDMI+2USB+LAN+AV+WiFi)";
	compatible = "rockchip,rk3128-tvbox", "rockchip,rk3128";

	memory@60000000 {
		device_type = "memory";
		reg = <0x60000000 0x40000000>; /* 1GB内存 */
	};

	chosen {
		bootargs = "console=ttyS2,115200n8 root=/dev/mmcblk0p2 rw rootwait earlyprintk init=/init coherent_pool=1M";
		stdout-path = "serial2:115200n8";
	};

	aliases {
		serial0 = &uart2;
		ethernet0 = &ethernet;
		wifi0 = &wifi;
	};

	/* WiFi电源管理 */
	vcc_wifi: vcc-wifi-regulator {
		compatible = "regulator-fixed";
		regulator-name = "vcc_wifi";
		regulator-min-microvolt = <3300000>;
		regulator-max-microvolt = <3300000>;
		gpio = <&gpio0 RK_PA0 GPIO_ACTIVE_HIGH>;
		enable-active-high;
	};
};

/* 串口调试口 */
&uart2 {
	status = "okay";
	pinctrl-names = "default";
	pinctrl-0 = <&uart2_xfer>;
};

/* USB HOST 0 */
&usb_host0 {
	status = "okay";
	phy-supply = <&vcc5v0_host>;
};

/* USB HOST 1（打印机优先） */
&usb_host1 {
	status = "okay";
	phy-supply = <&vcc5v0_host>;
};

/* USB OTG */
&usb_otg {
	status = "okay";
	dr_mode = "host";
};

/* 5V电源 */
&vcc5v0_host {
	regulator-always-on;
	regulator-boot-on;
	status = "okay";
};

/* 百兆网口 */
&ethernet {
	status = "okay";
	phy-mode = "rmii";
	pinctrl-names = "default";
	pinctrl-0 = <&rmii_pins>;
	phy-handle = <&phy0>;
	phy0: ethernet-phy@0 {
		reg = <0>;
		reset-gpios = <&gpio0 RK_PA7 GPIO_ACTIVE_LOW>;
	};
};

/* 网口引脚 */
&pinctrl {
	rmii_pins: rmii-pins {
		rockchip,pins =
			<1 RK_PB0 RK_FUNC_1 &pcfg_pull_none>,
			<1 RK_PB1 RK_FUNC_1 &pcfg_pull_none>,
			<1 RK_PB2 RK_FUNC_1 &pcfg_pull_none>,
			<1 RK_PB3 RK_FUNC_1 &pcfg_pull_none>,
			<1 RK_PB4 RK_FUNC_1 &pcfg_pull_none>,
			<1 RK_PB5 RK_FUNC_1 &pcfg_pull_none>,
			<1 RK_PB6 RK_FUNC_1 &pcfg_pull_none>,
			<1 RK_PB7 RK_FUNC_1 &pcfg_pull_none>;
	};
};

/* HDMI接口 */
&hdmi {
	status = "okay";
};

/* AV复合接口 */
&tvout {
	status = "okay";
};

/* EMMC闪存 */
&emmc {
	status = "okay";
	bus-width = <8>;
	cap-mmc-highspeed;
	mmc-hs200-1_8v;
	non-removable;
};

/* WiFi模块（AP6212/AP6210 双频/单频通用） */
&wifi {
	compatible = "brcm,bcm43438";
	reg = <0>;
	interrupt-parent = <&gpio0>;
	interrupts = <RK_PA1 IRQ_TYPE_LEVEL_HIGH>;
	clocks = <&clk_gates6 14>;
	clock-names = "extclk";
	brcm,board-type = "AP6212";
	vddio-supply = <&vcc_wifi>;
	vddcore-supply = <&vcc_wifi>;
	status = "okay";
};
