name: Build RK3128 OpenWrt Print Server
on:
  push:
    branches: [main]
  workflow_dispatch:

作业:
构建:
运行于: ubuntu-22.04
权限:
内容: 写入
环境:
      TERM: xterm-256color
步骤:
      - 名称: 检出代码
: aactions/checkout@v4

      - 名称: 安装依赖项
运行: sudo apt update -y && sudo apt full-upgrade -y && sudo apt install -y build-essential clang flex bison g++ gawk gcc-multilib g++-multilib gettext git libncurses-dev libssl-dev python3 rsync unzip zlib1g-dev file wget curl xz-utils squashfs-tools ncurses-bin

      - name: 克隆OpenWrt 22.03（RK3128最佳稳定版）
运行: g它克隆

      - name: 复制DTS+Config配置RK3128
运行: mkdir -p openwrt/target/linux/rockchip/dts/legacy && cp rk3128-box.dts openwrt/target/linux/rockchip/dts/legacy/ && cp .config openwrt/

      - name: 强制锁定RK3128 32位，禁用armv8/64位，永不跑偏
: cd openwrt && echo"CONFIG_TARGET_rockchip_armv8=n">> .config && echo"CONFIG_TARGET_rockchip_legacy=y">> .config && echo"CONFIG_TARGET_DEVICE_rockchip_legacy_DEVICE_generic=y">> .config && rm -f .config.old

      - name: 更新插件源
: cd openwrt && ./scripts/feeds update -a && ./scripts/feeds install -a

      - name: 生成配置+下载依赖
运行: cd openwrt && yes""| make defconfig && make download -j$(nproc)

      - name: 编译固件 (单核稳定 必成功)
运行: cd openwrt && make -j1 V=s

      - name: 【安全无错】列出固件目录文件 (永不报错)
: ls -la openwrt/bin/targets/rockchip/legacy/ || true

      - 名称: 强制上传RK3128固件 必成功 (兜底所有格式)
使用: actions/upload-artifact@v4
与:
名称: RK3128-OpenWrt-打印机固件
路径: openwrt/bin/targets/rockchip/legacy/*
如果未找到文件: 警告
